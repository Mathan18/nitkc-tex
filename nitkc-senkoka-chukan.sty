\NeedsTeXFormat{pLaTeX2e}
\ProvidesPackage{nitkc-senkoka-chukan}

% \sectionのフォーマット変更
% コードはsecdot.sty(https://www.ctan.org/pkg/secdot)のものを流用
% issue: 冒頭に書かないと動作しない（原因不明）
\newcommand\sectiondot[1]{
    \expandafter\def\csname @seccntfmt@#1\endcsname##1{
        \csname the##1\endcsname \hskip 1sp
    }
}
\sectiondot{section}
\renewcommand\@seccntformat[1]{\@ifundefined{@seccntfmt@#1}
    {\csname the#1\endcsname\quad}
    {\csname @seccntfmt@#1\endcsname{#1}}
}

% フォントサイズ指定
\newcommand{\FontsizeTitle}{\jsc@setfontsize{\FontsizeTitle}{15}{21}}
\newcommand{\FontsizeAuthor}{\jsc@setfontsize{\FontsizeAuthor}{12}{17}}
\newcommand{\FontsizeDepartment}{\jsc@setfontsize{\FontsizeDepartment}{9}{13}}
\newcommand{\FontsizeAffiliate}{\jsc@setfontsize{\FontsizeAffiliate}{10}{14}}
\newcommand{\FontsizeKeywords}{\jsc@setfontsize{\FontsizeKeywords}{9}{13}}
\newcommand{\FontsizeSection}{\jsc@setfontsize{\FontsizeSection}{11}{15}}
\newcommand{\FontsizeText}{\jsc@setfontsize{\FontsizeText}{10}{14}}
\newcommand{\FontsizeCitation}{\jsc@setfontsize{\FontsizeCitation}{7}{10}}
\newcommand{\FontsizeCaption}{\jsc@setfontsize{\FontsizeCaption}{10}{14}}

% 和文はイタリックの代わりにオブリークを使う
\def\jptextit#1{\makebox[5zw][l]{\vphantom{#1}\rotatebox{-48.8}{\scalebox{0.875}[1.143]{\rotatebox{41.2}{\smash{\rlap{#1}}}}}}}

% フォントスタイルの定義
\newcommand{\TitleFont}{\FontsizeTitle\gtfamily\bfseries\userelfont\selectfont}
\newcommand{\AuthorFont}{\FontsizeAuthor\mcfamily\mdseries\userelfont\selectfont}
\newcommand{\DepartmentFont}{\FontsizeDepartment\mcfamily\mdseries\userelfont\selectfont}
\newcommand{\AffiliateFont}{\FontsizeAffiliate\mcfamily\mdseries\userelfont\selectfont}
\newcommand{\KeywordsTitleFont}{\FontsizeKeywords\mcfamily\bfseries\userelfont\selectfont}
\newcommand{\KeywordsFont}{\FontsizeKeywords\mcfamily\mdseries\userelfont\selectfont}
\newcommand{\SectionFont}{\FontsizeSection\gtfamily\mdseries\userelfont\selectfont}
\newcommand{\TextFont}{\FontsizeText\mcfamily\mdseries\userelfont\selectfont}
\newcommand{\CitationFont}{\FontsizeCitation\mcfamily\mdseries\userelfont\selectfont}
\newcommand{\CaptionNumFont}{\FontsizeCaption\mcfamily\bfseries\userelfont\selectfont}
\newcommand{\CaptionTextFont}{\FontsizeCaption\mcfamily\mdseries\userelfont\selectfont}

% 引用スタイル変更
\DeclareRobustCommand\cite{\unskip
    \@ifnextchar [{\@tempswatrue\@citex}{\@tempswafalse\@citex[]}
}
\def\@cite#1{#1\if@tempswa\fi)}
\newcommand{\citations}[1]{$^{\hbox{\CitationFont{#1}}}$}

% 所属専攻，研究室，キーワード受け取り
\def\department#1{\gdef\@department{#1}}\def\@department{}
\def\affiliate#1{\gdef\@affiliate{#1}}\def\@affiliate{}
\def\keywords#1{\gdef\@keywords{#1}}\def\@keywords{}

% 脚注スタイル変更
\renewcommand\thefootnote{\FontsizeAffiliate *}
\renewcommand{\footnoterule}{
    \kern-3\jsc@mpt
    \hrule width \columnwidth height 0.4\jsc@mpt \kern 2.6\jsc@mpt
}

% 所属専攻と研究室を脚注に記述
\newcommand\DepartmentAndAffiliate{\FontsizeAffiliate \@department　\@affiliate}

% タイトル部のフォーマット変更，本文の2段組指定
\renewcommand{\maketitle}{
    \twocolumn[
        \begin{center}
            {\TitleFont \@title} \\
            \vskip 10\jsc@mpt
            {\AuthorFont \@author\footnotemark} \\
            {\DepartmentFont \@department} \\
            \vskip 10\jsc@mpt
            {{\KeywordsTitleFont \jptextit{キーワード}}{\KeywordsFont~:~\@keywords}}
        \end{center}
    ]
    \footnotetext{\DepartmentAndAffiliate}
}

% \sectionの見出しのフォーマット変更
\makeatletter
\renewcommand{\section}{
    \@startsection{section}{1}
    {1sp}{1sp}{1sp}% 見出し左，上，下の空き
    {\centering \SectionFont}% 中央揃え，フォント変更
}
\makeatother

% \sectionの数字とピリオドを全角に変更
\makeatletter
\def\@arabicz#1{%
  \ifcase#1 ０\or １\or ２\or ３\or ４\or ５\or ６\or ７\or ８\or ９\or １０\else\@ctrerr\fi}
\def\arabicz#1{\expandafter\@arabicz\csname c@#1\endcsname}
\renewcommand{\thesection}{\SectionFont \@arabicz\c@section．}
\makeatother

% \subsectionの見出しのフォーマット変更
\makeatletter
\renewcommand{\subsection}{
    \@startsection{subsection}{2}
    {10pt}% 見出し左の空き
    {1sp}{1sp}% 見出し上，下の空き
    {\SectionFont}% フォント変更
}
\makeatother

% \subsectionの数字のフォント変更
\makeatletter
\renewcommand{\thesubsection}{\SectionFont \@arabic\c@section.\@arabic\c@subsection}
\makeatother

% 図表タイトルのスタイル変更
\makeatletter
\renewcommand{\figurename}{Fig.~}
\renewcommand{\tablename}{Table~}
\makeatother

% キャプションのスタイル変更
\makeatletter
\long\def\@makecaption#1#2{{
    \small
    \advance\leftskip .0628\linewidth
    \advance\rightskip .0628\linewidth
    \vskip\abovecaptionskip
    \sbox\@tempboxa{{\CaptionNumFont #1}~\relax {\CaptionTextFont #2}}%
    \ifdim \wd\@tempboxa <\hsize \centering \fi
    {\CaptionNumFont #1}{~\relax}{\CaptionTextFont #2}\par
    \vskip\belowcaptionskip
}}
\makeatother

% 参考文献のスタイル変更
\makeatletter
\def\@biblabel#1{\inhibitglue #1)\inhibitglue}
\makeatother

\endinput
